#!/usr/bin/env bash

# Directory to store JSON files
DATA_DIR="pokemon_data"
LOG_FILE="$DATA_DIR/error.log"

# Create output directory and log file if they don't exist
mkdir -p "$DATA_DIR"
: > "$LOG_FILE"  # Clear old log

# List of Pokémon to fetch
POKEMONS=("bulbasaur" "ivysaur" "venusaur" "charmander" "charmeleon")

# Function to fetch data with retry logic
fetch_pokemon() {
  local name=$1
  local url="https://pokeapi.co/api/v2/pokemon/$name"
  local output_file="$DATA_DIR/$name.json"
  local attempts=0
  local max_attempts=3

  while (( attempts < max_attempts )); do
    echo "Fetching data for $name... (Attempt $((attempts + 1)))"
    curl -s --fail "$url" -o "$output_file"
    if [ $? -eq 0 ] && [ -s "$output_file" ]; then
      echo "Saved data to $output_file ✅"
      return 0
    fi
    ((attempts++))
    sleep 2
  done

  echo "❌ Failed to fetch data for $name after $max_attempts attempts." | tee -a "$LOG_FILE"
  rm -f "$output_file" 2>/dev/null
  return 1
}

# Loop through Pokémon list
for pokemon in "${POKEMONS[@]}"; do
  fetch_pokemon "$pokemon"
done
